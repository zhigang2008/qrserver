 {{template "header" .}}
<div style="background-color:#eee;padding:10px 0px;">
 <div class="container">
 	
 	<div class="row">
   <div id="div-list" class="col-md-1">
     <div class="btn-group-vertical">
     <!--<button type="button" class="btn btn-primary">等值线</button>-->
     <button type="button" class="btn btn-primary">保存图像</button>
     <button type="button" class="btn btn-primary">发送速报</button>
     </div> 
   </div>
   <div id="map" class="col-md-10"  style="height:550px;border:#F6F6F6 solid 1px;"></div>
  </div>
  
 </div>
 
</div>

{{template "scripts"}}

<script language="javascript" src="/static/js/openlayers/lib/OpenLayers.js"></script>

<script language="javascript">
var map, basicLayer, vectorLayer,selector;
var sites=[];
//最后的坐标
var lastlng={{.lastlng}}; //105.8;
var lastlat={{.lastlat}}; //32.44;
//放大倍数
var zoomSize=10;
 
var epsg4326 =  new OpenLayers.Projection("EPSG:4326"); //WGS 1984 projection
var projectTo;

  //初始化加载
$(document).ready(function() {
	//OpenLayers.Lang.setCode("zh-CN");
  map = new OpenLayers.Map('map');
  basicLayer = new OpenLayers.Layer.WMS("基础地图",
         "{{rawURL .gisServiceUrl}}{{rawURL .gisServiceParams}}&layers={{.gisBasicLayer}}",
          {layers: 'basic'});
  map.addLayer(basicLayer);
  
  projectTo = map.getProjectionObject();

  //feature 图层          
 // vectorLayer = new OpenLayers.Layer.Vector("数据层");
	//map.addLayer(vectorLayer);
 
 //测试数据
 /*var pointList = []; 

 for(var i=1;i<8;i++){ 
    newPoint = new OpenLayers.Geometry.Point(lastlng+Math.random(),lastlat+Math.random()); 
    pointList.push(newPoint); 
   
 } 
 lineFeature = new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(pointList),null,null); 
 vectorLayer.addFeatures([lineFeature]);
*/

 var wms = new OpenLayers.Layer.WMS("烈度等值线", 
    "{{rawURL .gisServiceUrl}}",
		{
			//LAYERS: 'maptest',
			TRANSPARENT: true,
			STYLES: '',
			//format: format,
			//VALUE_COLUMN:"AREA",
			SIMPLIFY_METHOD: 2,
			SIMPLIFY_SIZE:{{.dataSize}},
			DATA_ARRAY:"{{.dataArrayPGA}}",
			'INTERVALS[]':"0,1,2,3,4,10",
			'INTERVALS_COLORS[]':"0xffffffcc,0xff0000cc,0xffff00cc,0x00ff00cc,0x0000ffcc,0x0000ffcc",
			RENDERER_TYPE:2,
			INTERPOLATION_STRATEGY:2,
			RADIUS:40,
			SERVICE:"AMS"
		},
		{
			singleTile: true,
			transparent: true,
			isBaseLayer:false, 
			opacity: 0.5,
			ratio: 1} 
	);
 map.addLayer(wms);
 
  map.addControl(new OpenLayers.Control.LayerSwitcher({'ascending':false}));
  //map.addControl(new OpenLayers.Control.PanZoom());
  map.addControl(new OpenLayers.Control.ScaleLine());
  //map.addControl(new OpenLayers.Control.OverviewMap());
  //map.addControl(new OpenLayers.Control.EditingToolbar(vectorLayer));
  map.addControl(new OpenLayers.Control.MousePosition());
  
 //map.zoomToMaxExtent();
 map.setCenter(new OpenLayers.LonLat(lastlng, lastlat), zoomSize);
});

</script>

{{template "footer"}}